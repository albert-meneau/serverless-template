# My Service

<a href="https://coveralls.io/github/VEVO/my-service-name?branch=master">
  <img
    alt="tag:?"
    src="https://coveralls.io/repos/github/VEVO/my-service-name/badge.svg?branch=master&t=rRriby"
  />
</a>
<a href="https://github.com/vevo/my-service-name/releases">
  <img
    alt="tag:?"
    src="https://img.shields.io/badge/version-0.1.0-green.svg"
  />
</a>
<a href="https://vevowiki.atlassian.net/wiki/pages/viewpage.action?spaceKey=PTENG&title=Content+Services">
  <img
    alt="tag:?"
    src="https://img.shields.io/badge/team-content--services-green.svg"
  />
</a>

Description of your service here. Delete the README.md file and make this file be the readme.md

## Development Requirements

1. Docker + Docker Compose + Docker Machine
2. Serverless
3. Node + NPM

## Setup

```bash
git clone git@github.com:VEVO/my-service-name.git
cd my-service-name
make install
```

## Running

1. Set the Environment

```bash
# Set the NPM Token to pull down private repositories
export NPM_TOKEN=
```

2. Run

To invoke a function
```bash
serverless invoke --function name-of-function --data '{ "somedata": "if any"}'
```

The Node Application will start on the Docker Machine IP at port `80`. Configuration used by the application is supplied by the Docker Compose file for the development environment.

By default, the Application will use a Dev database (will be changed soon).

## Environment Setup

Other than using a mocked local DynamoDB, all other values have reasonable defaults for testing and development.
To override the defaults, provide the overrides in `.env` or `.envrc` if using [direnv](http://direnv.net)

```bash
NODE_ENV=test
#for testing purposes
TEST_CLIENT_ID={fake-client-id}
TEST_CLIENT_SECRET={fake-client-id}
```

## Routes

### ENVIRONMENTS
- **development**: https://my-service-name.vevodev.com
- **staging**: https://my-service-name.vevostg.com
- **production**: https://my-service-name.vevoprd.com

### CLIENT API
If you have a client API, put the endpoints here

### ADMIN API
If you have a admin  API, put the endpoints here

### CHECKS

1. ``GET /up``

    Quick check to make sure service is running.  Should return 204

2. ``GET /ready``

    Endpoint that digs in deeper to dependent resource.  Should return 204 if everything is good

3. ``GET /health``

    Has information about various dependencies

### NFS

1. ``POST /_nfs/logs``

    Get Logs generated by the application

    More documentation on supported parameters [here](https://github.com/winstonjs/winston#querying-logs)

2. ``GET /_nfs/api-docs.json``

    Get Swagger API Documentation

3. `GET /_nfs/swagger-ui``

    Get Swagger UI to look at the hosted documentation

4. `GET /_nfs/config`

    Get configuration used by the Application


## Testing

To do some linting
```bash
gulp lint
```

To test the lib modules
```bash
gulp lib-tests
```

To test the function handlers
```bash
gulp function-tests
```

To run all tests
```bash
gulp test
```

## Deploying

GOCD deployment to dev with Serverless
GOCD manual deploy to staging with Serverless
GOCD manual deploy to production with Serverless

## Developer Notes


#### Libraries Used
1. [Express](http://expressjs.com/)
2. [Convict](https://github.com/mozilla/node-convict)
3. [NFS Node](https://github.com/VEVO/nfs-node)
4. [Node Auth](https://github.com/VEVO/node-auth)
5. [Node DynamoDB](https://github.com/VEVO/node-dynamodb)
6. [Node Errors](https://github.com/VEVO/node-errors)


#### Testing Frameworks
Mocha, Chai, Istanbul, ESlint

#### Build Tools
Gulp, Make

Most of the time, make targets should work. Gulp targets will need additional environment setup via `.env`.